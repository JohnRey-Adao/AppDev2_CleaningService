<div class="dashboard-container">
  <!-- Header Section -->
  <div class="row mb-5">
    <div class="col-12">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <h1 class="display-6 fw-bold text-primary mb-2">
            <i class="fas fa-home me-3"></i>Customer Dashboard
          </h1>
          <p class="text-secondary mb-0">Manage your bookings and find professional cleaners</p>
        </div>
        <div class="text-end">
          <div class="badge bg-primary fs-6 px-3 py-2">
            <i class="fas fa-user me-2"></i>Customer Account
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="row mb-4">
    <div class="col-12">
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <button class="nav-link" [class.active]="activeTab==='overview'" (click)="setActiveTab('overview')">
            <i class="fas fa-chart-line me-2"></i>Overview
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" [class.active]="activeTab==='bookings'" (click)="setActiveTab('bookings')">
            <i class="fas fa-list me-2"></i>My Bookings
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" [class.active]="activeTab==='cleaners'" (click)="setActiveTab('cleaners')">
            <i class="fas fa-users me-2"></i>Available Cleaners
          </button>
        </li>
        <li class="nav-item">
          <button class="nav-link" [class.active]="activeTab==='profile'" (click)="setActiveTab('profile')">
            <i class="fas fa-user me-2"></i>Profile
          </button>
        </li>
      </ul>
    </div>
  </div>

  <div class="tab-content">
    <!-- Overview Tab -->
    <div class="tab-pane" [class.active]="activeTab==='overview'">
      <div class="row g-4 mb-5">
        <div class="col-lg-3 col-md-6" *ngFor="let card of [
          {icon:'calendar-check', title:'Total Bookings', value: totalBookings, cls:'text-primary', bg:'bg-primary'},
          {icon:'clock', title:'Pending', value: pendingBookings, cls:'text-warning', bg:'bg-warning'},
          {icon:'check-circle', title:'Completed', value: completedBookings, cls:'text-success', bg:'bg-success'},
          {icon:'dollar-sign', title:'Total Spent', value: (totalSpent | currency), cls:'text-info', bg:'bg-info'}
        ]; let i = index">
          <div class="card dashboard-card h-100">
            <div class="card-body text-center p-4">
              <div class="mb-3">
                <div class="rounded-circle d-inline-flex align-items-center justify-content-center {{card.bg}} text-white" 
                     style="width: 60px; height: 60px;">
                  <i class="fas fa-{{card.icon}} fa-lg"></i>
                </div>
              </div>
              <h6 class="card-title fw-bold text-secondary mb-2">{{ card.title }}</h6>
              <h3 class="fw-bold {{card.cls}} mb-0">{{ card.value }}</h3>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-4">
                  <button class="btn btn-primary w-100 py-3" (click)="setActiveTab('cleaners')">
                    <i class="fas fa-search me-2"></i>Find Cleaners
                  </button>
                </div>
                <div class="col-md-4">
                  <button class="btn btn-outline-primary w-100 py-3" (click)="setActiveTab('bookings')">
                    <i class="fas fa-list me-2"></i>View Bookings
                  </button>
                </div>
                <div class="col-md-4">
                  <button class="btn btn-outline-secondary w-100 py-3" (click)="setActiveTab('profile')">
                    <i class="fas fa-user me-2"></i>Update Profile
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bookings Tab -->
    <div class="tab-pane" [class.active]="activeTab==='bookings'">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5><i class="fas fa-list me-2"></i>My Bookings</h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Cleaner</th>
                      <th>Duration</th>
                      <th>Amount</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let booking of bookings">
                      <td>{{ formatDate(booking.bookingDate) }}</td>
                      <td>{{ booking.cleaner.firstName }} {{ booking.cleaner.lastName }}</td>
                      <td>{{ booking.durationHours }}h</td>
                      <td>{{ booking.totalAmount | currency }}</td>
                      <td>
                        <span class="badge" [ngClass]="getStatusClass(booking.status)">
                          {{ booking.status }}
                        </span>
                      </td>
                      <td>
                        <button class="btn btn-sm btn-outline-danger" 
                                *ngIf="booking.status === 'PENDING' || booking.status === 'CONFIRMED'"
                                (click)="cancelBooking(booking.id)">
                          Cancel
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cleaner Selection Tab -->
    <div class="tab-pane" [class.active]="activeTab==='cleaners'">
      <div class="row">
        <!-- Cleaners Selection -->
        <div class="col-md-8">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5><i class="fas fa-users me-2"></i>Available Cleaners</h5>
              <div class="d-flex gap-2">
                <input type="date" class="form-control" [(ngModel)]="selectedDate" 
                       (change)="filterCleanersByDate()" placeholder="Filter by date">
                <button class="btn btn-outline-primary btn-sm" (click)="filterCleanersByDate()">
                  <i class="fas fa-filter me-1"></i>Filter
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="row" *ngIf="filteredCleaners.length > 0; else noCleaners">
                <div class="col-md-6 col-lg-4 mb-3" *ngFor="let cleaner of filteredCleaners">
                  <div class="card h-100 cleaner-card" 
                       [class.selected]="selectedCleanerId === cleaner.id"
                       (click)="selectCleaner(cleaner.id)">
                    <div class="card-body text-center">
                      <div class="cleaner-image mb-3">
                        <img [src]="getCleanerImage(cleaner)" 
                             [alt]="cleaner.firstName + ' ' + cleaner.lastName"
                             class="rounded-circle" 
                             style="width: 80px; height: 80px; object-fit: cover;">
                      </div>
                      <h6 class="card-title">{{ cleaner.firstName }} {{ cleaner.lastName }}</h6>
                      <p class="text-muted small mb-2">{{ cleaner.hourlyRate | currency }}/hour</p>
                      <p class="card-text small" *ngIf="cleaner.bio">{{ cleaner.bio | slice:0:100 }}{{ cleaner.bio.length > 100 ? '...' : '' }}</p>
                      <div class="mt-2">
                        <span class="badge bg-success">{{ cleaner.cleanerStatus }}</span>
                      </div>
                    </div>
                    <div class="card-footer text-center" *ngIf="selectedCleanerId === cleaner.id">
                      <i class="fas fa-check-circle text-success"></i> Selected
                    </div>
                  </div>
                </div>
              </div>
              <ng-template #noCleaners>
                <div class="text-center py-4">
                  <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
                  <h5 class="text-muted">No cleaners available</h5>
                  <p class="text-muted">Try selecting a different date or check back later.</p>
                </div>
              </ng-template>
            </div>
          </div>
        </div>

        <!-- Booking Form -->
        <div class="col-md-4">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-plus me-2"></i>Book a Cleaner</h5>
            </div>
            <div class="card-body">
              <!-- Success/Error Messages -->
              <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
                {{ successMessage }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
              <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
                {{ errorMessage }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>

              <form (ngSubmit)="createBooking()">
                <div class="mb-3">
                  <label class="form-label">Date & Time</label>
                  <input type="datetime-local" class="form-control" [(ngModel)]="bookingDate" 
                         (change)="onDateChange()" name="date" required>
                </div>
                
                <div class="mb-3">
                  <label class="form-label">Duration (hours)</label>
                  <input type="number" class="form-control" [(ngModel)]="durationHours" name="duration" min="1" max="8" required>
                </div>
                
                <div class="mb-3">
                  <label class="form-label">Special Instructions</label>
                  <textarea class="form-control" [(ngModel)]="specialInstructions" name="instructions" rows="3"></textarea>
                </div>
                
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary" [disabled]="!selectedCleanerId || !bookingDate">
                    <i class="fas fa-calendar-plus me-1"></i>Book Now
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Tab -->
    <div class="tab-pane" [class.active]="activeTab==='profile'">
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5><i class="fas fa-user me-2"></i>My Profile</h5>
              <img [src]="customer ? getCustomerImage(customer) : 'assets/images/default-user.svg'" [alt]="(customer?.firstName || 'Customer') + ' ' + (customer?.lastName || '')" class="rounded-circle" style="width:48px;height:48px;object-fit:cover;">
            </div>
            <div class="card-body">
              <p><strong>Name:</strong> {{ customer?.firstName }} {{ customer?.lastName }}</p>
              <p><strong>Email:</strong> {{ customer?.email }}</p>
              <p><strong>Phone:</strong> {{ customer?.phoneNumber || 'Not provided' }}</p>
              <p><strong>Address:</strong> {{ customer?.address }}</p>
              <p><strong>City:</strong> {{ customer?.city || 'Not provided' }}</p>
              <p><strong>Bio:</strong> {{ customer?.bio || 'No bio provided' }}</p>
              <button class="btn btn-outline-primary btn-sm" (click)="editingProfile = true">Edit Profile</button>
            </div>
          </div>
        </div>
        <div class="col-md-6" *ngIf="editingProfile && customer">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-edit me-2"></i>Edit Profile</h5>
            </div>
            <div class="card-body">
              <form (ngSubmit)="saveCustomerProfile()">
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">First Name</label>
                    <input class="form-control" [(ngModel)]="customer.firstName" name="firstName">
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Last Name</label>
                    <input class="form-control" [(ngModel)]="customer.lastName" name="lastName">
                  </div>
                </div>
                <div class="mb-3">
                  <label class="form-label">Phone</label>
                  <input class="form-control" [(ngModel)]="customer.phoneNumber" name="phone">
                </div>
                <div class="mb-3">
                  <label class="form-label">Address</label>
                  <input class="form-control" [(ngModel)]="customer.address" name="address">
                </div>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">City</label>
                    <input class="form-control" [(ngModel)]="customer.city" name="city">
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Region</label>
                    <input class="form-control" [(ngModel)]="customer.region" name="region">
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Postal Code</label>
                    <input class="form-control" [(ngModel)]="customer.postalCode" name="postalCode">
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">Country</label>
                    <input class="form-control" [(ngModel)]="customer.country" name="country">
                  </div>
                </div>
                <div class="mb-3">
                  <label class="form-label">Bio</label>
                  <textarea class="form-control" [(ngModel)]="customer.bio" name="bio" rows="3" placeholder="Tell us about yourself..."></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Profile Picture</label>
                  <input type="file" class="form-control" (change)="onPhotoSelected($event)" accept="image/*">
                </div>
                <div class="d-flex gap-2">
                  <button class="btn btn-primary" type="submit">Save</button>
                  <button class="btn btn-secondary" type="button" (click)="editingProfile = false">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
